<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC   "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd"
>

<mapper namespace="com.back.admin.dao.AdminWriteDAO">

	<select id="callCourtList" resultType="com.back.admin.dto.AdminCourtDTO">
	
		SELECT
			court_name AS courtName
			,court_address AS courtAddress
			,court_idx AS courtIdx
		FROM court 
		WHERE court_state = 'true'
		AND court_official = 'true'
		
	</select>
	
	<!-- match_list -->
	
	<!-- list -->
	<select id="officialList" resultType="com.back.admin.dto.AdminWriteDTO">
		SELECT
		   	official_match_idx
		  	,official_match_date
		  	,(SELECT court_address FROM court c WHERE c.court_idx = o.court_idx) AS court_address
		  	,official_match_level
		  	,(SELECT count(official_match_idx) FROM offcial_match_ask_list f 
		  	WHERE f.official_match_idx = o.official_match_idx) AS currentCount
		  	,official_match_to
		  	,official_match_post_state
			FROM official_match o
			JOIN court t
			ON o.court_idx = t.court_idx
		WHERE t.court_state = 'true'
	</select>	
	
	<select id="callCourtInfo" resultType="com.back.admin.dto.AdminCourtDTO">
		SELECT
			court_name AS courtName
			,court_address AS courtAddress
			,court_idx AS courtIdx
		FROM court
		WHERE court_idx = #{param1}
	</select>
	
	<select id="fileNameList" resultType="String">
		SELECT
			file_name
		FROM court_image
		WHERE court_idx = #{param1}
	</select>
	
	<select id="bookingStartTime" resultType="String">
		SELECT official_match_start_time   
		from official_match  
		WHERE court_idx = #{param1}
		AND official_match_date = #{param2}

	</select>
	
	<insert id="officialWrite">
		INSERT INTO 
		official_match(
			court_idx
			,official_match_gender
			,official_match_level
			,official_match_to
			,official_match_to_state
			,official_match_info
			,official_match_fee
			,official_match_date
			,official_match_start_time
			,official_match_end_time
			,official_match_state
			,official_match_post_state
		)
		VALUES(
			#{courtIdx}
			,#{officialGender}
			,#{officialLevel}
			,#{officialTO}
			,'모집중'
			,#{officialInfo}
			,#{officialPrice}
			,#{officialDate}
			,#{officialStartTime}
			,#{officialEndTime}
			,#{officialIsDisabled}
			,'true'
		)
	</insert>
	
	<select id="officialUpdateGo" resultType="com.back.admin.dto.AdminWriteDTO">
		SELECT 
			official_match_idx AS officialIdx
			,court_idx AS courtIdx
			,official_match_gender AS officialGender
			,official_match_level AS officialLevel
			,official_match_to AS officialTO
			,official_match_to_state AS officialTOState
			,official_match_info AS officialInfo
			,official_match_fee AS officialPrice
			,official_match_date AS officialDate
			,official_match_start_time AS officialStartTime
			,official_match_end_time AS officialEndTime
			,official_match_state AS officialMatchState
			,official_match_post_state AS officialState
		FROM official_match
		WHERE official_match_idx = #{param1}
	</select>
	
	<update id="officialUpdate" parameterType="map">
	UPDATE official_match
	SET court_idx = #{courtIdx}
		,official_match_gender = #{officialGender}
		,official_match_level = #{officialLevel}
		,official_match_to = #{officialTO}
		,official_match_info = #{officialInfo}
		,official_match_fee = #{officialPrice}
		,official_match_date = #{officialDate}
		,official_match_start_time = #{officialStartTime}
		,official_match_end_time = #{officialEndTime}
		,official_match_post_state = #{officialState}
	WHERE official_match_idx = #{officialIdx}
	</update>
	
	<select id="teamList" resultType="com.back.admin.dto.AdminWriteDTO">
		SELECT 
			join_team_idx 
			,logo
			,team_name
			,id
			,join_team_state
			FROM team_join tj
			JOIN team t
			WHERE tj.team_idx = t.team_idx
		<choose>
			<when test='searchFlag == "true" and searchCategory == "teamName"'>
				AND team_name like CONCAT('%', #{searchWord}, '%')
			</when>
			<when test='searchFlag == "true" and searchCategory == "teamLeaderName"'>
				AND id like CONCAT('%', #{searchWord},'%')
			</when>
			<when test='address != null'>
				AND team_address like CONCAT('%', #{address}, '%')
			</when>
		</choose>
		LIMIT #{start}, 10

	</select>	
	
	<select id="addressList" resultType="String">
		SELECT team_address
		FROM team 
		GROUP BY team_address
	</select>	
	
	<select id="totalPage" resultType="int">
		SELECT COUNT(tj.join_team_idx)
			FROM team_join tj
			JOIN team t 
			WHERE tj.team_idx = t.team_idx
		<choose>
			<when test='searchFlag == "true" and searchCategory == "teamName"'>
				AND team_name like CONCAT('%', #{searchWord}, '%')
			</when>
			<when test='searchFlag == "true" and searchCategory == "teamLeaderName"'>
				AND id like CONCAT('%', #{searchWord},'%')
			</when>
			<when test='address != null'>
				AND team_address like CONCAT('%', #{address}, '%')
			</when>
		</choose>
	</select>	
	
</mapper>






















